<!DOCTYPE html>
<html lang="es" data-theme="cupcake">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat con Socket.io</title>
    <link href="/public/output.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="h-screen">

    <div class="drawer lg:drawer-open">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />

        <!-- Contenido de la página (Chat) -->
        <div class="drawer-content flex flex-col h-screen">
            <header class="bg-base-200 p-4 shadow flex items-center gap-4">
                <!-- Botón para abrir/cerrar el drawer en pantallas pequeñas -->
                <label for="my-drawer-2" class="btn btn-primary drawer-button lg:hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </label>
                <h1 class="text-2xl font-bold text-center flex-1">Chat Global</h1>
            </header>

            <main id="messages" class="flex-1 p-4 overflow-y-auto bg-base-100">
                <!-- Los mensajes del chat se agregarán aquí -->
            </main>

            <footer class="bg-base-200 p-4">
                <form id="form" class="flex gap-2">
                    <input id="input" autocomplete="off" class="input input-bordered flex-1" placeholder="Escribe un mensaje..." />
                    <button class="btn btn-primary">Enviar</button>
                </form>
            </footer>
        </div>

        <!-- Contenido del Sidebar -->
        <div class="drawer-side">
            <label for="my-drawer-2" aria-label="close sidebar" class="drawer-overlay"></label>
            <div id="sidebar_container" class="w-80 min-h-full bg-base-200 rounded-br-2xl lg:rounded-br-none">
                <!-- El contenido de sidebar.html se cargará aquí -->
            </div>
        </div>
    </div>

    <script type="module">
        import { loadComponent } from '/src/lib/Load.js';

        document.addEventListener('DOMContentLoaded', () => {
            loadComponent('sidebar_container', '/src/components/sidebar.html');
        });

        // --- Lógica del chat (sin cambios) ---
        const socket = io();
        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        socket.on('chat message', (msg) => {
            const item = document.createElement('div');
            item.className = 'chat chat-start';
            
            const avatar = `<div class="chat-image avatar"><div class="w-10 rounded-full"><img alt="Avatar" src="https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg" /></div></div>`;
            const header = `<div class="chat-header">Anónimo <time class="text-xs opacity-50">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</time></div>`;
            const bubble = `<div class="chat-bubble">${msg}</div>`;

            item.innerHTML = avatar + header + bubble;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        });
    </script>

</body>
</html>